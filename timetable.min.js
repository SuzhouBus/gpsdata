'use strict';var THRESHOLD=30*60;function removeChildren(parent){while(parent.hasChildNodes()){parent.removeChild(parent.childNodes[0])}}function parseUrlHash(){var line=location.hash.replace('#','');if(line){loadData(line)}}function timeDelta(time1,time2){var BASE=60;var components1=time1.split(':');var components2=time2.split(':');var result=0;var sign=1;if(components1.length<components2.length){var _ref=[components2,components1];components1=_ref[0];components2=_ref[1];sign=-1}var lengthDelta=components1.length-components2.length;for(var i=0;i<lengthDelta;++i){result*=BASE;result+=parseInt(components1[i])}for(var _i=0;_i<components2.length;++_i){result*=BASE;result+=components1[lengthDelta+_i]-components2[_i]}return sign*result}function formatTimeDelta(delta,length){var BASE=60;if(delta==0){return new Array(length).fill('00').join(':')}var prefix='';if(delta<0){prefix='-';delta=-delta}var result=[];do{var lower=(delta%BASE).toString();if(lower.length==1){lower='0'+lower}delta=Math.trunc(delta/BASE);result.unshift(lower)}while(delta>0&&(!length||result.length<length-1));if(delta>0){var highest=delta.toString();if(highest.length==1){highest='0'+highest}result.unshift(highest)}while(length&&result.length<length){result.unshift('00')}return prefix+result.join(':')}function loadData(line,data){document.getElementById('line').value=line;var content=document.getElementById('content');removeChildren(content);if(data){showData(parseData(data))}else{fetch(line+'.csv').then(function(x){return x.text()}).then(parseData)./*then(data => document.getElementById('logs').value = JSON.stringify(data, null, '  ')).*/then(showData).catch(function(){alert('Failed to load data.')})}}function parseData(data){var linesSet=new Set;return data.split(/\r\n|\r|\n/).filter(function(x){return linesSet.has(x)?false:(linesSet.add(x),true)}).map(function(x){var values=x.split(',');if(values.length>=6){return{stopName:values[0],stopId:values[1],licenseId:values[2],time:values[3],date:values[4],direction:values[5]}}else{return null}}).filter(function(x){return x}).reduce(function(result,current){if(!result[current.date]){result[current.date]={}}var newRange={startTime:current.time,startStopName:current.stopName,startStopId:current.stopId,endTime:current.time,endStopName:current.stopName,endStopId:current.stopId,direction:current.direction};if(!result[current.date][current.licenseId]){result[current.date][current.licenseId]=[newRange];return result}var ranges=result[current.date][current.licenseId];var lastRange=ranges[ranges.length-1];if(current.stopName==lastRange.endStopName&&current.stopName==lastRange.startStopName&&current.direction==lastRange.direction){lastRange.startTimeInstructed=lastRange.startTime;lastRange.endTime=lastRange.startTime=current.time}else if(timeDelta(current.time,lastRange.endTime)>THRESHOLD||lastRange.direction!=current.direction){ranges.push(newRange)}else{lastRange.endTime=current.time;lastRange.endStopName=current.stopName;lastRange.endStopId=current.stopId}return result},{})}function showData(data){var maxRanges=Object.keys(data).reduce(function(max,date){return Math.max(max,Object.keys(data[date]).reduce(function(max,licenseId){return Math.max(max,data[date][licenseId].length)},0))},0);Object.keys(data).sort().forEach(function(date){var h2=document.createElement('h2');h2.appendChild(document.createTextNode(date));content.appendChild(h2);var table=document.createElement('table');var tbody=document.createElement('tbody');Object.keys(data[date]).sort(function(a,b){var data2=data[date];return timeDelta(data2[a][0].startTime,data2[b][0].startTime)}).forEach(function(licenseId){var ranges=data[date][licenseId];var tr=document.createElement('tr');var th=document.createElement('th');th.appendChild(document.createTextNode(licenseId));tr.appendChild(th);ranges.forEach(function(range){var td=document.createElement('td');td.appendChild(document.createTextNode(range.startStopName));td.appendChild(document.createElement('br'));td.appendChild(document.createTextNode(range.startTime));tr.appendChild(td);td=document.createElement('td');td.appendChild(document.createTextNode(range.endStopName));td.appendChild(document.createElement('br'));td.appendChild(document.createTextNode(range.endTime));tr.appendChild(td)});tbody.appendChild(tr)});table.appendChild(tbody);content.appendChild(table)})}document.addEventListener('DOMContentLoaded',function(){var file=document.getElementById('file');window.onpopstate=function(e){if(e.state){loadData(e.state)}else{parseUrlHash()}};document.getElementById('load').addEventListener('click',function(){loadData(document.getElementById('line').value)});file.addEventListener('change',function(){if(file.files&&file.files.length){var reader=new FileReader;reader.onload=function(){loadData(file.files[0].name,reader.result)};reader.readAsText(file.files[0])}});if(file.files&&FileReader){document.getElementById('file_container').style.display=''}parseUrlHash()});

//# sourceMappingURL=timetable.min.js.map