'use strict';function removeChildren(parent){while(parent.hasChildNodes()){parent.removeChild(parent.childNodes[0])}}function fillSelect(select,labels,values){removeChildren(select);labels.forEach(function(label,index){var option=document.createElement('option');option.value=values?values[index]||label:label;option.appendChild(document.createTextNode(label));select.appendChild(option)})}
'use strict';var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i['return'])_i['return']()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var lineSeparatorRegEx=/\r|\n|\r\n/;var allLines={};var allData={};var fetchPromise=fetch('wj_all.guid').then(function(x){return x.text()}).then(function(data){var lineChooser=document.getElementById('lineChooser');data.split(lineSeparatorRegEx).filter(function(x){return x}).map(function(x){return x.split(/\t/)}).forEach(function(line){var guid=line[0];var name=line[1];var direction=line[2];if(!allLines[name])allLines[name]=[];allLines[name].push({direction:direction,guid:guid})});fillSelect(lineChooser,Object.keys(allLines).sort())}).then(function(_){return fetch('wj_timetable.csv')}).then(function(x){return x.text()}).then(function(data){document.getElementById('progress').style.display='none';data.split(lineSeparatorRegEx).forEach(function(entry){var values=entry.split(',');var date=values[0];var licenseId=values[1];var time=values[2];var lineGuid=values[3];if(!allData[lineGuid])allData[lineGuid]={};if(!allData[lineGuid][date])allData[lineGuid][date]=[];allData[lineGuid][date].push({licenseId:licenseId,time:time})})});document.addEventListener('DOMContentLoaded',function(){document.getElementById('lineChooser').addEventListener('change',function(){onLineChange()});document.getElementById('dateChooser').addEventListener('change',function(){onDateChange()});fetchPromise.then(function(_){return onLineChange()})});function defaultCompare(a,b){if(a>b)return 1;if(a<b)return-1;return 0}function onLineChange(){var lineChooser=document.getElementById('lineChooser');var dateChooser=document.getElementById('dateChooser');var originalDate=dateChooser.value;var dates=Object.keys(allData[allLines[lineChooser.value][0].guid]).sort();fillSelect(dateChooser,dates);if(dates.includes(originalDate))dateChooser.value=originalDate;onDateChange()}function parseByLineDate(line,date){var timetable={};var directions=allLines[line];directions.forEach(function(line,directionId){allData[line.guid][date].forEach(function(current){if(!timetable[current.licenseId])timetable[current.licenseId]=[];timetable[current.licenseId].push({directionId:directionId,time:current.time})})});var maxCols=0;var _loop=function _loop(licenseId,_runs){timetable[licenseId]=_runs=_runs.sort(function(a,b){return defaultCompare(a.time,b.time)});var currentDirection=0;var runsCount=0;_runs.forEach(function(details){if(currentDirection!=details.directionId)++runsCount;++runsCount;currentDirection=details.directionId==1?0:1});maxCols=Math.max(maxCols,runsCount);runs=_runs};var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=Object.entries(timetable)[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var _ref=_step.value;var _ref2=_slicedToArray(_ref,2);var licenseId=_ref2[0];var runs=_ref2[1];_loop(licenseId,runs)}}catch(err){_didIteratorError=true;_iteratorError=err}finally{try{if(!_iteratorNormalCompletion&&_iterator['return']){_iterator['return']()}}finally{if(_didIteratorError){throw _iteratorError}}}var order=Object.keys(timetable).sort(function(a,b){return defaultCompare(timetable[a][0].directionId,timetable[b][0].directionId)||defaultCompare(timetable[a][0].time,timetable[b][0].time)});return{maxCols:maxCols,data:new Map(order.map(function(k){return[k,timetable[k]]}))}}function onDateChange(){var lineChooser=document.getElementById('lineChooser');var dateChooser=document.getElementById('dateChooser');var _parseByLineDate=parseByLineDate(lineChooser.value,dateChooser.value),maxCols=_parseByLineDate.maxCols,data=_parseByLineDate.data;var table=document.createElement('table');table.border=1;var tbody=document.createElement('tbody');var tr=document.createElement('tr');var th=document.createElement('th');th.rowSpan=2;th.appendChild(document.createTextNode('\u8F66\u724C\u53F7'));var th2=document.createElement('th');th2.colSpan=maxCols;th2.appendChild(document.createTextNode('\u53D1\u8F66\u65F6\u95F4'));tr.appendChild(th);tr.appendChild(th2);tbody.appendChild(tr);var tr2=document.createElement('tr');var directionShortNames=[allLines[lineChooser.value][0].direction,allLines[lineChooser.value][1].direction];for(var i=0;i<Math.min(directionShortNames[0].length,directionShortNames[1].length);++i){if(directionShortNames[0][i]==directionShortNames[1][i])continue;directionShortNames[0]=directionShortNames[0].substr(0,i+1);directionShortNames[1]=directionShortNames[1].substr(0,i+1)}for(var _i=0;_i<maxCols;++_i){var _th=document.createElement('th');var direction=allLines[lineChooser.value][_i%2];_th.title=direction.direction;_th.appendChild(document.createTextNode(directionShortNames[_i%2]));tr2.appendChild(_th)}tbody.appendChild(tr2);var _loop2=function _loop2(licenseId,_runs2){var tr=document.createElement('tr');var td=document.createElement('td');td.appendChild(document.createTextNode(licenseId));tr.appendChild(td);var currentDirection=0;var colCount=0;_runs2.forEach(function(details){if(currentDirection!=details.directionId){var _td=document.createElement('td');tr.appendChild(_td);++colCount}currentDirection=details.directionId==1?0:1;var td=document.createElement('td');td.appendChild(document.createTextNode(details.time));tr.appendChild(td);++colCount});for(var _i2=0;_i2<maxCols-colCount;++_i2){var _td2=document.createElement('td');tr.appendChild(_td2)}tbody.appendChild(tr)};var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=data[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var _ref3=_step2.value;var _ref4=_slicedToArray(_ref3,2);var licenseId=_ref4[0];var _runs2=_ref4[1];_loop2(licenseId,_runs2)}}catch(err){_didIteratorError2=true;_iteratorError2=err}finally{try{if(!_iteratorNormalCompletion2&&_iterator2['return']){_iterator2['return']()}}finally{if(_didIteratorError2){throw _iteratorError2}}}table.appendChild(tbody);var content=document.getElementById('content');removeChildren(content);content.appendChild(table)}

//# sourceMappingURL=wj_timetable.min.js.map