'use strict';function removeChildren(parent){while(parent.hasChildNodes()){parent.removeChild(parent.childNodes[0])}}function fillSelect(select,labels,values){removeChildren(select);labels.forEach(function(label,index){var option=document.createElement('option');option.value=values?values[index]||label:label;option.appendChild(document.createTextNode(label));select.appendChild(option)})}
'use strict';var lineSeparatorRegEx=/\r|\n|\r\n/;var allData={};fetch('/wj_all.guid').then(function(x){return x.text()}).then(function(data){var lineChooser=document.getElementById('lineChooser');var lines=data.split(lineSeparatorRegEx).filter(function(x){return x}).map(function(x){return x.split(/\t/)});fillSelect(lineChooser,lines.map(function(line){return line[1]+' ('+line[2]+')'}),lines.map(function(line){return line[0]}))}).then(function(_){return fetch('/wj_timetable.csv')}).then(function(x){return x.text()}).then(function(data){document.getElementById('progress').style.display='none';data.split(lineSeparatorRegEx).forEach(function(entry){var values=entry.split(',');var date=values[0];var licenseId=values[1];var time=values[2];var lineGuid=values[3];if(!allData[lineGuid])allData[lineGuid]={};if(!allData[lineGuid][date])allData[lineGuid][date]=[];allData[lineGuid][date].push({licenseId:licenseId,time:time})})});document.addEventListener('DOMContentLoaded',function(){var lineChooser=document.getElementById('lineChooser');var dateChooser=document.getElementById('dateChooser');lineChooser.addEventListener('change',function(){fillSelect(dateChooser,Object.keys(allData[lineChooser.value]).sort())});dateChooser.addEventListener('change',function(){var timetable=allData[lineChooser.value][dateChooser.value].reduce(function(result,current){if(!result[current.licenseId])result[current.licenseId]=[];result[current.licenseId].push(current.time);return result},{});var order=Object.keys(timetable).sort(function(a,b){if(timetable[a][0]>timetable[b][0])return 1;else if(timetable[a][0]<timetable[b][0])return-1;else return 0});var table=document.createElement('table');var tbody=document.createElement('tbody');var tr=document.createElement('tr');var th=document.createElement('th');th.appendChild(document.createTextNode('\u8F66\u724C\u53F7'));var th2=document.createElement('th');th2.colspan=Object.keys(timetable).reduce(function(max,cur){return timetable[cur].length>max?timetable[cur].length:max},0);th2.appendChild(document.createTextNode('\u53D1\u8F66\u65F6\u95F4'));tr.appendChild(th);tr.appendChild(th2);tbody.appendChild(tr);order.forEach(function(licenseId){var tr=document.createElement('tr');var td=document.createElement('td');td.appendChild(document.createTextNode(licenseId));tr.appendChild(td);timetable[licenseId].forEach(function(time){var td=document.createElement('td');td.appendChild(document.createTextNode(time));tr.appendChild(td)});tbody.appendChild(tr)});table.appendChild(tbody);var content=document.getElementById('content');removeChildren(content);content.appendChild(table)})});

//# sourceMappingURL=wj_timetable.min.js.map